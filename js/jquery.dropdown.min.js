!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){var b={options:{optionClass:"",dropdownClass:"",autoinit:!1,callback:!1,onSelected:!1,dynamicOptLabel:"Add a new option..."},init:function(c){function d(d){if(!d.data("dropdownjs")&&d.is("select")){var e=d.attr("multiple"),f=d.attr("data-dynamic-opts"),g=a(),h=a("<div></div>");h.addClass("dropdownjs").addClass(c.dropdownStyle),h.data("select",d);var i=a("<input type=text readonly class=fakeinput>");a.material&&i.data("mdproc",!0),h.append(i);var j=a("<ul></ul>");j.data("select",d),h.append(j),i.attr("placeholder",d.attr("placeholder")),d.find("option").each(function(){var c=a(this);b._addOption(j,c)}),f&&(g=a("<li class=dropdownjs-add></li>"),g.append("<input>"),g.find("input").attr("placeholder",c.dynamicOptLabel),j.append(g));h.find("li");if(e){var m=[],n=d.val();for(var o in n)m.push("li[value="+n[o]+"]");m.length>0&&b._select(h,h.find(m.join(",")))}else{var l;l=d.find(":selected").length?d.find(":selected").last():d.find("option, li").first(),b._select(h,l)}i.addClass(d[0].className),d.hide().attr("data-dropdownjs",!0),d.after(h),c.callback&&c.callback(h),j.on("click","li:not(.dropdownjs-add)",function(c){b._select(h,a(this)),d.change()}),j.on("keydown","li:not(.dropdownjs-add)",function(c){return 27===c.which?(a(".dropdownjs > ul > li").attr("tabindex",-1),i.removeClass("focus").blur()):32!==c.which||a(c.target).is("input")?void 0:(b._select(h,a(this)),!1)}),j.on("focus","li:not(.dropdownjs-add)",function(){d.is(":disabled")||i.addClass("focus")}),f&&f.length&&g.on("keydown",function(b){if(13===b.which){var c=a("<option>"),e=g.find("input").val();g.find("input").val(""),c.attr("value",e),c.text(e),d.append(c)}}),d.on("DOMNodeInserted",function(c){var d=a(c.target);d.val().length&&(b._addOption(j,d),j.find("li").not(".dropdownjs-add").attr("tabindex",0))}),d.on("change",function(c){var f=a(c.target);if(f.val().length)if(e)b._select(h,d.find(":selected"));else{var g;g=d.find(":selected").length?d.find(":selected").last():d.find("option, li").first(),b._select(h,g)}}),i.on("click focus",function(b){if(b.stopPropagation(),!d.is(":disabled")){a(".dropdownjs > ul > li").attr("tabindex",-1),a(".dropdownjs > input").not(a(this)).removeClass("focus").blur(),a(".dropdownjs > ul > li").not(".dropdownjs-add").attr("tabindex",0);var c={top:a(this).offset().top-a(document).scrollTop(),left:a(this).offset().left-a(document).scrollLeft(),bottom:a(window).height()-(a(this).offset().top-a(document).scrollTop()),right:a(window).width()-(a(this).offset().left-a(document).scrollLeft())},e=c.bottom;e<200&&c.top>c.bottom?(e=c.top,j.attr("placement","top-left")):j.attr("placement","bottom-left"),a(this).next("ul").css("max-height",e-20),a(this).addClass("focus")}}),a(document).on("click",function(b){e&&a(b.target).parents(".dropdownjs").length||a(b.target).parents(".dropdownjs-add").length||a(b.target).is(".dropdownjs-add")||(a(".dropdownjs > ul > li").attr("tabindex",-1),i.removeClass("focus"))})}}c=c?a.extend(b.options,c):b.options,c.autoinit&&a(document).on("DOMNodeInserted",function(b){var e=a(b.target);e.is("select")||(e=e.find("select")),e.is(c.autoinit)&&e.each(function(){d(a(this))})}),a(this).each(function(){d(a(this))})},select:function(c){var d=a(this).find('[value="'+c+'"]');b._select(a(this),d)},_select:function(b,c){if(!c.is(".dropdownjs-add")){var d=b.data("select"),e=b.find("input.fakeinput"),f=d.attr("multiple"),g=b.find("li");if(f){c.toggleClass("selected"),c.each(function(){var b=d.find('[value="'+a(this).attr("value")+'"]');b.prop("selected",a(this).hasClass("selected"))});var h=[];g.each(function(){a(this).hasClass("selected")&&h.push(a(this).text())}),e.val(h.join(", "))}f||(c.is("li")&&g.not(c).removeClass("selected"),c.addClass("selected"),d.val(c.attr("value")),e.val(c.text().trim())),a.material&&(e.val().trim()?d.removeClass("empty"):d.addClass("empty")),this.options.onSelected&&this.options.onSelected(c.attr("value"))}},_addOption:function(b,c){var d=a("<li></li>");d.addClass(this.options.optionStyle),c.text()?d.text(c.text()):d.html("&nbsp;"),d.attr("value",c.val()),b.data("select").attr("data-dynamic-opts")&&(d.append("<span class=close></span>"),d.find(".close").on("click",function(){d.remove(),c.remove()})),c.prop("selected")&&(d.attr("selected",!0),d.addClass("selected")),b.find(".dropdownjs-add").length?b.find(".dropdownjs-add").before(d):b.append(d)}};a.fn.dropdown=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"==typeof c|!c?b.init.apply(this,arguments):void a.error("Method "+c+" does not exists on jQuery.dropdown")}});
